defmodule MessageTest do
  @moduledoc false
  use ExUnit.Case
  doctest QRCode.Message

  alias QRCode.{QR, Message}
  alias QRCode.ErrorCorrection, as: ECC

  test "should generate the right message" do
    qr = %QR{
      ecc_level: :quartile,
      version: 5,
      ecc: %ECC{
        ec_codewrods_per_block: 18,
        blocks_in_group1: 2,
        codewords_per_block_in_group1: 15,
        blocks_in_group2: 2,
        codewords_per_block_in_group2: 16,
        groups: {
          [
            [67, 85, 70, 134, 87, 38, 85, 194, 119, 50, 6, 18, 6, 103, 38],
            [246, 246, 66, 7, 118, 134, 242, 7, 38, 86, 22, 198, 199, 146, 6]
          ],
          [
            [182, 230, 247, 119, 50, 7, 118, 134, 87, 38, 82, 6, 134, 151, 50, 7],
            [70, 247, 118, 86, 194, 6, 151, 50, 16, 236, 17, 236, 17, 236, 17, 236]
          ]
        },
        codewords: {
          [
            [
              213,
              199,
              11,
              45,
              115,
              247,
              241,
              223,
              229,
              248,
              154,
              117,
              154,
              111,
              86,
              161,
              111,
              39
            ],
            [87, 204, 96, 60, 202, 182, 124, 157, 200, 134, 27, 129, 209, 17, 163, 163, 120, 133]
          ],
          [
            [
              148,
              116,
              177,
              212,
              76,
              133,
              75,
              242,
              238,
              76,
              195,
              230,
              189,
              10,
              108,
              240,
              192,
              141
            ],
            [235, 159, 5, 173, 24, 147, 59, 33, 106, 40, 255, 172, 82, 2, 131, 32, 178, 236]
          ]
        }
      }
    }

    expected =
      <<0b01000011111101101011011001000110010101011111011011100110111101110100011001000010111101110111011010000110000001110111011101010110010101110111011000110010110000100010011010000110000001110000011001010101111100100111011010010111110000100000011110000110001100100111011100100110010101110001000000110010010101100010011011101100000001100001011001010010000100010001001011000110000001101110110000000110110001111000011000010001011001111001001010010111111011000010011000000110001100100001000100000111111011001101010101010111100101001110101111000111110011000111010010011111000010110110000010110001000001010010110100111100110101001010110101110011110010100100110000011000111101111011011010000101100100111111000101111100010010110011101111011111100111011111001000100001111001011100100011101110011010101111100010000110010011000010100010011010000110111100001111111111011101011000000111100110101011001001101011010001101111010101001001101111000100010000101000000010010101101010001101101100100000111010000110100011111100000010000001101111011110001100000010110010001001111000010110001101111011000000000::size(
          1079
        )>>

    %QR{message: msg} = Message.put(qr)

    assert msg == expected
  end
end
